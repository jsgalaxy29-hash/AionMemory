@page "/potager/edit/{recordId?}"
@inject IMetadataService Metadata
@inject IDataEngine DataEngine
@inject NavigationManager Navigation

<h3>Nouvelle culture</h3>
@if (PotagerEntity is null)
{
    <p>Module Potager non disponible.</p>
}
else
{
    <DynamicForm EntityType="PotagerEntity" DataEngine="DataEngine" OnSaved="Saved" />
}

@code {
    [Parameter] public string? RecordId { get; set; }
    private S_EntityType? PotagerEntity { get; set; }

    protected override async Task OnInitializedAsync()
    {
        var modules = await Metadata.GetModulesAsync();
        PotagerEntity = modules.FirstOrDefault(m => m.Name.Contains("Potager", StringComparison.OrdinalIgnoreCase))?.EntityTypes.FirstOrDefault();
    }

    private void Saved(F_Record record)
    {
        Navigation.NavigateTo($"/records/{PotagerEntity?.Name}/{record.Id}");
    }
}